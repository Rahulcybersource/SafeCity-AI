import speech_recognition as sr
from config import MAX_RECORDING_TIME

def capture_audio():
    """Capture audio from microphone and return recognized text."""
    recognizer = sr.Recognizer()
    try:
        with sr.Microphone() as source:
            print("üé§ Listening... Please speak now!")
            audio = recognizer.listen(source, timeout=MAX_RECORDING_TIME)
        text = recognizer.recognize_google(audio)
        print(f"‚úÖ Recognized: {text}")
        return text
    except sr.UnknownValueError:
        print("‚ùå Could not understand audio")
        return None
    except sr.RequestError as e:
        print(f"‚ùå Error: {e}")
        return None

def process_voice_input():
    """Process voice input and return recognized message."""
    message = capture_audio()
    if message:
        return message
    return "Emergency alert - voice recognition failed"
